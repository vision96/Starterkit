'use strict';

var _postcss = require('postcss');

module.exports = function (source, reversed) {
  var sourceAst = (0, _postcss.parse)(source);
  var reversedAst = (0, _postcss.parse)(reversed);
  var totalNodes = reversedAst.nodes.length;

  var diff = '';

  var _loop = function _loop(i) {
    var isAdded = false;
    var sNode = sourceAst.nodes[i];
    var rNode = reversedAst.nodes[i];
    var sDcl = sNode.nodes;
    var rDcl = rNode.nodes;

    sDcl.forEach(function (dcl, index) {
      if (dcl.toString() !== rDcl[index].toString()) {
        if (!isAdded) {
          diff += rNode.selector + ' {\n';
          isAdded = true;
        }
        diff += '  ' + rDcl[index].toString() + ';\n';
      }
    });

    if (isAdded) {
      diff += '}\n';
    }
  };

  for (var i = 0; i < totalNodes; i++) {
    _loop(i);
  }

  return diff;
};